---
title: 'MAT 8444 Final Project'
author: "Katherine M. Prioli"
date: "May 08, 2019"
output:
  pdf_document: default
  html_document: default
geometry: margin = 0.5in
references:
- URL: https://fred.stlouisfed.org/series/A229RX0Q048SBEA 
  author:
  - family: Federal Reserve Bank of St. Louis
  id: fred_disposable
  issued:
    year: 2018
  title: Real Disposable Personal Income - Per Capita
- URL: https://fred.stlouisfed.org/series/TDSP
  author:
  - family: Federal Reserve Bank of St. Louis
  id: fred_debt
  issued:
    year: 2018
  title: Household Debt Service Payments as a Percent of Disposable Personal Income
- URL: https://fred.stlouisfed.org/series/A072RC1Q156SBEA
  author:
   - family: Federal Reserve Bank of St. Louis
  id: fred_savings
  issued:
    year: 2018
  title: Personal Saving as a Percent of Disposable Personal Income
- URL: https://github.com/kmprioliPROF/MAT_8444_Final_Project
  author:
  - family: Prioli
    given: Katherine M.
  id: kmpgit
  issued:
    month: 05
    year: 2019
  title: MAT_8444_Final_Project
- URL: http://www.jstatsoft.org/article/view/v027i03
  author: 
  - family: Hyndman
    given: Rob
  - family: Khandakar
    given: Yeasmin
  id: pkg_forecast
  issued: 
    year: 2008
  title: Automatic time series forecasting\: the forecast package for R
- URL: https://github.com/nickpoison/astsa
  author: 
  - family: Stoffer
    given: David
  id: pkg_astsa
  issued: 
    year: 2019
  title: astsa\: Applied Statistical Time Series Analysis
abstract: "BACKGROUND text METHODS text RESULTS text CONCLUSION text"
---

```{r setup, include = FALSE, warning = FALSE, results = "hide", echo = FALSE, message = FALSE}
# Loading libraries

library(tidyverse)
library(forecast)     # For tidy time series analysis and graphics
library(ggthemr)      # For prettifying output
library(gridExtra)    # For grid.arrange()
library(grid)         # For arrangeGrob()
library(astsa)        # For sarima() and sarima.for()
library(scales)       # For dollar_format()

ggthemr("flat")
```


## **Background**


THe objective of this study was to analyze US household debt service payments and personal savings as they relate to real per-capita disposable income over time.

## **Methods**

The analytic dataset consisted of three time series (TS) variables (Table 1).  All variables were obtained from the Federal Reserve Bank of St. Louis, all share a common year of valuation ($US 2012), and all have already been seasonally adjusted.


| **Variable**      	| **Description**                                                                                 	| **Reference**    	|
|-------------------	|-------------------------------------------------------------------------------------------------	|------------------	|
| `fred_disposable` 	| Per-capita disposable income, adjusted for inflation in chained $US 2012, seasonally adjusted   	| @fred_disposable 	|
| `fred_debt`       	| Household debt service payments as a percent of disposable personal income, seasonally adjusted 	| @fred_debt       	|
| `fred_savings`    	| Personal saving as a percentage of disposable personal income, seasonally adjusted              	| @fred_savings    	|

The data were be limited to a common time horizon (Q1 1980 through Q3 2018), yielding 155 observations for each TS.

### *Data Exploration*

Each TS was separately explored via the `forecast::autoplot()` function, which yields plots for the raw time series along with its autocorrelation (ACF) and partial autocorrelation (PACF) functions.  Classical decomposition was performed for each TS via `decompose()` to understand the seasonality, if any, of these time series.  To understand how savings may be dependent on debt, the cross-correlation function (CCF) was computed and plotted for `fred_savings` vs. `fred_debt`.

### *Modeling the Time Series*

For each TS, the model suggested by `forecast::auto.arima()` was fit using `forecast::Arima()`, and model fit was assesed through analysis of residuals using `forecast::checkresiduals()`.


All analyses were performed in R (R v. 3.5.1, R Foundation for Statistical Computing, Vienna, Austria) using packages `forecast` (@pkg_forecast) and `astsa` (@pkg_astsa) for specialized time series calculations and plots.  All statistical tests were evaluated against a significance threshold of $\alpha = 0.05$.

## **Results**

Text

### *Data Exploration*

```{r wrangle, echo = FALSE, message = FALSE, warning = FALSE, fig.width = 10, fig.height = 8}
fred_disposable <- read_csv("data/fred_disposable.csv") %>%
  rename(disposable = A229RX0Q048SBEA) %>%
  filter(DATE > "1979-12-31") %>% 
  select(-DATE) %>% 
  ts(start = 1980, frequency = 4)

fred_debt <- read_csv("data/fred_debt.csv") %>%
  rename(debt = TDSP) %>%
  select(-DATE) %>% 
  ts(start = 1980, frequency = 4)

fred_savings <- read_csv("data/fred_savings.csv") %>%
  rename(savings = A072RC1Q156SBEA) %>%
  filter(DATE > "1979-12-31") %>% 
  select(-DATE) %>% 
  ts(start = 1980, frequency = 4)
```

Figures 1-3 show the `autoplot()` output for the three time series.  A generally increasing trend is seen in the plot of disposable income (Fig. 1).  Because these data are adjusted for inflation to \$US 2012, this trend represents a true increase in disposable income, not inflation, and thus the time series is not stationary and will require differencing.  The ACF plot shows a slow linear decline in $\hat{\rho}(h)$ with increasing *h*, suggesting nonstationarity.  The graphs of debt payments and savings (Figs. 2 and 3 respectively) do not exhibit any simple trend, but do fluctuate over time, though without any apparent seasonality (which is expected, because the data are provided in seasonally adjusted form).  Additionally, the ACF plots for both debt payments and savings are suggestive of nonstationarity due to their slow decline.

<!-- ARCH/GARCH behavior is also possible for each of these three TS, but the ACF plots for each of the squared time series (not shown here in the interest of brevity) did not meaningfully differ from the ACF plots of the raw TS. -->

```{r exploration, echo = FALSE, message = FALSE, warning = FALSE, fig.width = 10, fig.height = 6}
fred_disp_plot <- ggtsdisplay(fred_disposable, points = FALSE, lag.max = 50,
  main = "Figure 1.  Real Disposable Personal Income Per Capita")

fred_debt_plot <- ggtsdisplay(fred_debt, points = FALSE, lag.max = 50,
  main = "Figure 2.  Household Debt Service Payments as a Percent of Disposable Personal Income")

fred_savings_plot <- ggtsdisplay(fred_savings, points = FALSE, lag.max = 50,
  main = "Figure 3.  Personal Savings as a Percent of Disposable Personal Income")
```

Figures 4-6 show the results of differencing.  After differencing, COMPLETE THIS

```{r exploration, echo = FALSE, message = FALSE, warning = FALSE, fig.width = 10, fig.height = 6}
ddisp <- diff(fred_disposable)
ddebt <- diff(fred_debt)
dsavings <- diff(fred_savings)

fred_disp_plot <- ggtsdisplay(ddisp, points = FALSE, lag.max = 50,
  main = "Figure 4.  Real Disposable Personal Income Per Capita, Differenced Once")

fred_debt_plot <- ggtsdisplay(ddebt, points = FALSE, lag.max = 50,
  main = "Figure 5.  Household Debt Service Payments as a Percent of Disposable Personal Income, 
  Differenced Once")

fred_savings_plot <- ggtsdisplay(dsavings, points = FALSE, lag.max = 50,
  main = "Figure 6.  Personal Savings as a Percent of Disposable Personal Income, Differenced Once")
```

Classical decomposition of each TS is shown in Figs. 7-9.  For each TS, the seasonal component was small in magnitude when compared to the raw TS, with personal savings having the most pronounced seasonal component.

```{r decomposition, echo = FALSE, message = FALSE, warning = FALSE, fig.width = 10, fig.height = 6}
fred_disp_decompose <- decompose(fred_disposable) %>% 
  autoplot(main = "Figure 7.  Disposable Personal Income, Decomposition")
fred_disp_decompose

fred_debt_decompose <- decompose(fred_debt) %>% 
  autoplot(main = "Figure 8.  Debt Service Payments, Decomposition")
fred_debt_decompose

fred_savings_decompose <- decompose(fred_savings) %>% 
  autoplot(main = "Figure 9.  Personal Savings, Decomposition")
fred_savings_decompose
```

The cross-correlation function for savings vs. debt is shown in Fig. 10.  For the raw data, several negative values are seen for the CCF at lags $h = -1$ through $h = -18$, indicating that decreasing household debt may be a good predictor for increasing savings at these lags.  For the differenced data, there is a cross-correlation seen at lag $h = -1$; however, it is small in magnitude and thus differenced debt at $h = -1$ is not expected to be a good predictor of differenced savings.

```{r ccf, echo = FALSE, message = FALSE, warning = FALSE, fig.width = 10, fig.height = 4}
dbt <- as.vector(fred_debt)
sav <- as.vector(fred_savings)
ddbt <- as.vector(ddebt)
dsav <- as.vector(dsavings)
ccf_raw <- ggCcf(x = dbt, y = sav) + ylim(-1, 1) + ggtitle("Savings vs. Debt")
ccf_diff <- ggCcf(x = ddbt, y = dsav) + ylim(-1, 1) + 
  ggtitle("Differenced Savings vs. Differenced Debt")
grid.arrange(ccf_raw, ccf_diff, nrow = 1,
             top = textGrob("Figure 10.  Cross-Correlation Function",
                            gp = gpar(fontsize = 16, fontface = "bold", col = "#34495E"),
                            x = 0.025, hjust = 0))
```

### *Modeling the Time Series*

```{r autoarima_disposable, echo = FALSE, message = FALSE, warning = FALSE, fig.width = 10, fig.height = 4}
aarima_disp <- auto.arima(fred_disposable)
```

For disposable income, the model suggested by `auto.arima()` was ARIMA $(2,1,0) \times (0,0,1)_{4}$; `checkresiduals()` output for the fitted model is shown in Fig. 11.  The Ljung-Box test (not shown in Fig. 11) yielded a *p*-value of 0.8403 over 8 lags, indicating that the residuals are consistent with white noise.  This conclusion is supported by the plots in Fig. 11 - namely, the ACF plot looks like white noise, and the histogram demonstrates good approximate normality of residuals.  This model fits the data reasonably well.

```{r sarima_disp, echo = FALSE, message = FALSE, warning = FALSE, fig.width = 10, fig.height = 6}
disp_fit <- Arima(fred_disposable, order = c(2,1,0), seasonal = c(0,0,1), include.drift = TRUE)
#disp_fit

checkresiduals(disp_fit, points = FALSE)
```

```{r autoarima_debt, echo = FALSE, message = FALSE, warning = FALSE, fig.width = 10, fig.height = 4}
aarima_debt <- auto.arima(fred_debt)
aarima_debt
```

For debt, `auto.arima()` suggested ARIMA $(1,1,2) \times (1,0,1)_{4}$.  Output from `checkresiduals()` for the fitted model is shown in Fig. 12.  The Ljung-Box test was nonsignificant at $p = 0.3764$ over 8 lags; additionally, the ACF plot has the appearance of white noise and the histogram shows that residuals are approximately normally distributed.  Thus this model fits well.

```{r sarima_disp, echo = FALSE, message = FALSE, warning = FALSE, fig.width = 10, fig.height = 6}
debt_fit <- Arima(fred_debt, order = c(1,1,2), seasonal = c(1,0,1), include.drift = FALSE)
debt_fit

checkresiduals(debt_fit, points = FALSE)
```

```{r autoarima_savings, echo = FALSE, message = FALSE, warning = FALSE, fig.width = 10, fig.height = 4}
aarima_savings <- auto.arima(fred_savings)
aarima_savings
```

For savings, `auto.arima()` suggested ARMA $(1,1,0)$, with no seasonal component.  The `checkresiduals()` output is presented in Fig. 13.  The Ljung-Box test was once again nonsignificant at $p = 0.5447$ over 8 lags, the ACF plot of residuals is consistent with white noise, and the histogram shows good approximate normality of residuals; thus, the model fits well.

```{r sarima_disp, echo = FALSE, message = FALSE, warning = FALSE, fig.width = 10, fig.height = 6}
savings_fit <- Arima(fred_savings, order = c(1,1,0), include.drift = FALSE)
savings_fit

checkresiduals(savings_fit, points = FALSE)
```





## **Discussion**

Text


### *Limitations*




## **Conclusion**

Moar text




Goals for the project include:

* Exploring these data through ACF, PACF
* Fitting an appropriate model to these data
* Determining what other variable(s) may be required if a regression is attempted

I'm particularly interested in understanding the decrease in savings percentage since the 1980s.  I suspect this is in part due to the Reagan-era deregulations of mortgage down payments, which disincentivized saving the traditional 20%.  Another contributing factor could be lifestyle inflation.  I also aim to forecast per-capita personal income through Q1 2021 (10 lags in the future from end of data) with a 95% prediction interval, as well as point estimates and 95% PIs for percent debt and percent savings through Q1 2021, with translation of these percentages into dollar values (point estimates and 95% PI) based on the predicted per-capita personal income.


## **References**